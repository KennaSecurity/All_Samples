# Vulnerability CSV reports

Scripts that produce CSV reports.

`vuln_reporting.rb` produces CSV reports and optionally send them via email 
`csv_extract_with_details.rb` produces a report of all vulnerabilities in Kenna including details. 

## vuln_reporting.rb Usage
Meta File should have 3 columns

query
query_name
email_recipients

Script will process a report for each line in the meta file and optionally email it to the listed recipient(s)

    vuln_reporting.rb <Kenna_API_token> <instruction_meta_file.csv> <include_solution?> <send_mail?> [opt_mail_server] [opt_port] [opt_username] [opt_password] [opt_from_address]

If send_mail = true then opt params are required. 

### Tested on
    ruby 2.6.10p210 (2022-04-12 revision 67958) [universal.x86_64-darwin22]

### Required Ruby classes/gems
    rest-client
    csv
    json
    mail

## csv_extract_with_details.rb Usage
The script pages through all assets and then uses groups of assets IDs to pull down vulnerabilities in chunks small enough to include details. 

    csv_extract_with_details.rb <Kenna_API_token> <assetsPerQuery> <OutputReportName> <IncludeDetails> [optRiskMeterID] [optQParam] [optBase_url]

- assetsPerQuery - should be adjusted so that the vulns pulled back does not exceed 20 pages. Script with throw and error if 20 pages are exceeded, or if too many assets per query is specified.
- OutputReportName - CSV file that will hold the results.
- IncludeDetails - true or false (note you must have platform permissions for your Kenna Instance to export details)
- optRiskMeterID - if risk meter (asset group) id is provided, only assets/vulns from that risk meter will be returned in the query. If left null, all active assets will be used for the vuln query.
- optQParam - used in conjunction with the risk meter option if the risk meter has additional params that need to be processed. optRiskMeterID is used for the bulk query against the assets table but when retrieving the individual vulns a query string will be needed. Example RM query tag:(1 2 3) & vulnerability_score:>69. Risk meter id will get the correct assets returned for tag:(1 2 3) but if you don't pass "vulnerability_score:>69 in the optQParam then you will get all vulns on the assets instead of just those with score over 69. 
- optBase_url - defaults to US API url, but should be set for EU or private deployments

### Tested on
    ruby 2.6.10p210 (2022-04-12 revision 67958) [universal.x86_64-darwin22]

### Required Ruby classes/gems
rest-client
json
